let Declaration = require('../declaration')
let {
<<<<<<< HEAD
  getGridGap,
  inheritGridGap,
  parseTemplate,
  warnGridGap,
  warnMissedAreas
=======
  parseTemplate,
  warnMissedAreas,
  getGridGap,
  warnGridGap,
  inheritGridGap
>>>>>>> 4f9d35bd5c5bf095848f6fc99f7e7bfe5212365f
} = require('./grid-utils')

class GridTemplate extends Declaration {
  /**
   * Translate grid-template to separate -ms- prefixed properties
   */
  insert(decl, prefix, prefixes, result) {
    if (prefix !== '-ms-') return super.insert(decl, prefix, prefixes)

    if (decl.parent.some(i => i.prop === '-ms-grid-rows')) {
      return undefined
    }

    let gap = getGridGap(decl)

    /**
     * we must insert inherited gap values in some cases:
     * if we are inside media query && if we have no grid-gap value
     */
    let inheritedGap = inheritGridGap(decl, gap)

<<<<<<< HEAD
    let { areas, columns, rows } = parseTemplate({
=======
    let { rows, columns, areas } = parseTemplate({
>>>>>>> 4f9d35bd5c5bf095848f6fc99f7e7bfe5212365f
      decl,
      gap: inheritedGap || gap
    })

    let hasAreas = Object.keys(areas).length > 0
    let hasRows = Boolean(rows)
    let hasColumns = Boolean(columns)

    warnGridGap({
<<<<<<< HEAD
      decl,
      gap,
      hasColumns,
=======
      gap,
      hasColumns,
      decl,
>>>>>>> 4f9d35bd5c5bf095848f6fc99f7e7bfe5212365f
      result
    })

    warnMissedAreas(areas, decl, result)

    if ((hasRows && hasColumns) || hasAreas) {
      decl.cloneBefore({
        prop: '-ms-grid-rows',
<<<<<<< HEAD
        raws: {},
        value: rows
=======
        value: rows,
        raws: {}
>>>>>>> 4f9d35bd5c5bf095848f6fc99f7e7bfe5212365f
      })
    }

    if (hasColumns) {
      decl.cloneBefore({
        prop: '-ms-grid-columns',
<<<<<<< HEAD
        raws: {},
        value: columns
=======
        value: columns,
        raws: {}
>>>>>>> 4f9d35bd5c5bf095848f6fc99f7e7bfe5212365f
      })
    }

    return decl
  }
}

GridTemplate.names = ['grid-template']

module.exports = GridTemplate
