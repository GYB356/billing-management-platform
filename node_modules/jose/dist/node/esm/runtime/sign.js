<<<<<<< HEAD
import * as crypto from 'node:crypto';
import { promisify } from 'node:util';
=======
import * as crypto from 'crypto';
import { promisify } from 'util';
>>>>>>> 4f9d35bd5c5bf095848f6fc99f7e7bfe5212365f
import nodeDigest from './dsa_digest.js';
import hmacDigest from './hmac_digest.js';
import nodeKey from './node_key.js';
import getSignKey from './get_sign_verify_key.js';
<<<<<<< HEAD
const oneShotSign = promisify(crypto.sign);
const sign = async (alg, key, data) => {
    const k = getSignKey(alg, key, 'sign');
    if (alg.startsWith('HS')) {
        const hmac = crypto.createHmac(hmacDigest(alg), k);
        hmac.update(data);
        return hmac.digest();
    }
    return oneShotSign(nodeDigest(alg), data, nodeKey(alg, k));
=======
let oneShotSign;
if (crypto.sign.length > 3) {
    oneShotSign = promisify(crypto.sign);
}
else {
    oneShotSign = crypto.sign;
}
const sign = async (alg, key, data) => {
    const keyObject = getSignKey(alg, key, 'sign');
    if (alg.startsWith('HS')) {
        const hmac = crypto.createHmac(hmacDigest(alg), keyObject);
        hmac.update(data);
        return hmac.digest();
    }
    return oneShotSign(nodeDigest(alg), data, nodeKey(alg, keyObject));
>>>>>>> 4f9d35bd5c5bf095848f6fc99f7e7bfe5212365f
};
export default sign;
